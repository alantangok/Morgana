<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="images/favicon.png"/>
    <meta name="viewport" content="width=device-width,initial-scale=0.7, maximum-scale=0.7, user-scalable=no"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="Shoot em' up"/>
    <link rel="manifest" href="/manifest.json"/>
    <title>Morgana Shoot em' up</title>

    <link rel="stylesheet" href="css/bootstrap.min.css?v=0.613">
    <link href="css/normalize.css?v=0.613" media="screen, print" rel="stylesheet" type="text/css"/>
    <link href="css/delta.css?v=0.613" media="screen, print" rel="stylesheet" type="text/css"/>

    <link href="static/css/main.01e9d104.chunk.css?v=0.613" rel="stylesheet">
    <link href="css/morgana-game.css?v=0.613" rel="stylesheet">
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>

<!-- The Modal -->
<div class="modal fade" id="login" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Login</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div id="root"></div>
                <hr>
                <button class="btn playAsGuest">Play as guest?</button>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer"></div>

        </div>
    </div>
</div>

<!-- The Modal -->
<div class="modal fade" id="charaterSelector" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Choose your Morgana</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="main">
                    <ul class="cards"></ul>
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer"></div>

        </div>
    </div>
</div>

<!-- The Modal -->
<div class="modal fade" id="scoreLeaderboard">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Leaderboard</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body"></div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="jq('#scoreLeaderboard').modal('hide');">
                    Close
                </button>
            </div>

        </div>
    </div>
</div>

<div id="delta">

    <button class="cn-button" id="cn-button">+</button>
    <div class="cn-wrapper" id="cn-wrapper">
        <ul>
            <li class="waveProgress fire"><a href="#" data-attack="fire"></a></li>
            <li class="waveProgress ice"><a href="#" data-attack="ice"></a></li>
            <li class="waveProgress energy_ball"><a href="#" data-attack="energy_ball"></a></li>
            <li class="attackBtn fire"><a href="#" data-attack="fire"><img src="images/ui/attackButton/pumpkin.png"></a></li>
            <li class="attackBtn ice"><a href="#" data-attack="ice"><img src="images/ui/attackButton/ghost-fire.png"></a></li>
            <li class="attackBtn energy_ball"><a href="#" data-attack="energy_ball"><img src="images/ui/attackButton/phantom.png"></a></li>
        </ul>
    </div>
    <div id="cn-overlay" class="cn-overlay"></div>

    <div id="scoreboard">
        <span class="lives"><span class="label">LIVES:</span><img class="one" src="images/life.png"><img class="two"
                                                                                                         src="images/life.png"><img
                class="three" src="images/life.png"></span>
        <span class="score"><span class="label">SCORE:</span><span class="value">00000</span></span>
    </div>

    <img id="booting" src='images/booting.gif'>

    <h1 id="title" style="display:none;">Morgana</h1>
    <h2 id="start" style="display:none;">press "spacebar" or touch the screen</h2>
    <h1 id="prepare" style="display:none;">Go fight!</h1>

    <canvas id="canvas">
        <div class="unsupported">
            Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element
        </div>
    </canvas>

    <div id='sound' class='on' title='toggle music and fx' style="display:none;"></div>

</div>

<script src="js/react.js?v=0.613"></script>
<script src="static/js/2.316cc20d.chunk.js?v=0.613"></script>
<script src="static/js/main.e06d2db9.chunk.js?v=0.613"></script>

<script src="js/jquery-3.6.0.min.js?v=0.613"></script>
<script src="js/bootstrap.bundle.min.js?v=0.613"></script>
<script>var jq = $.noConflict();</script>

<script src="js/vendor.js?v=0.613"></script>
<script src="js/game.js?v=0.613"></script>
<script src="js/delta.js?v=0.613"></script>

<script>
    (function(){

        var button = document.getElementById('cn-button'),
            wrapper = document.getElementById('cn-wrapper'),
            overlay = document.getElementById('cn-overlay');

        //open and close menu when the button is clicked
        var open = false;
        // button.addEventListener('click', handler, false);
        // wrapper.addEventListener('click', cnhandle, false);

        function cnhandle(e){
            e.stopPropagation();
        }

        function handler(e){
            if (!e) var e = window.event;
            e.stopPropagation();//so that it doesn't trigger click event on document

            if(!open){
                openNav();
            }
            else{
                closeNav();
            }
        }
        function openNav(){
            open = true;
            button.innerHTML = "-";
            jq(wrapper).addClass('opened-nav');
        }
        function closeNav(){
            open = false;
            button.innerHTML = "+";
            jq(wrapper).removeClass('opened-nav');
        }
        // jq('#canvas').on('click', function (event) {closeNav();});
        window.openNav = function(){openNav();}
        window.closeNav = function(){closeNav();}

    })();

    var walletAddress = "";
    var appendedList = [];
    var runnging = false;
    var loadingSpinner = '<div class="spinner-border" role="status">\n' +
        '  <span class="sr-only">Loading...</span>\n' +
        '</div>';

    function chooseCh() {
        jq('#login .modal-body').empty().append(loadingSpinner);
        jq.ajax({
            method: "POST",
            url: "api/getMetadata.php",
            data: {
                addressArray: JSON.stringify(nftAccounts)
            }
        })
            .done(function (data) {
                jq('#login').modal('hide');
                var imagesList = JSON.parse(data);
                jq(imagesList).each(function (index, element) {
                    if (appendedList.indexOf(element.id) == -1) {
                        jq('#charaterSelector .cards').append('<li class="cards_item">\n' +
                            '                            <a href="#" data-id="' + element.id + '">\n' +
                            '                                <div class="card">\n' +
                            '                                    <div class="card_image">\n' +
                            '                                        <img src="images/morgana/' + element.id + '.png"/>\n' +
                            '                                    </div>\n' +
                            '\n' +
                            '                                    <div class="card_content">\n' +
                            '                                        <h3 class="card_title">' + element.name + '</h3>\n' +
                            '                                    </div>\n' +
                            '                                </div>\n' +
                            '                            </a>\n' +
                            '                        </li>')

                    }
                    appendedList.push(element.id);
                    console.log(appendedList);
                });

                jq('#charaterSelector').modal('show');
                jq('.cards_item a').on('click', function (event) {
                    morganaId = jq(event.target).parents('a').data("id");
                    enterGame(morganaId);
                    jq('#charaterSelector').modal('hide');
                });
            });

        jq('.score').on('click', function (event) {
            getScore();
            return false;
        });

    }

    function enterGame(morganaId) {
        document.getElementById('delta').style.display = 'contents';
        if (!runnging) {
            Delta(morganaId);
            runnging = true;
        }
    }

    function updateScore(score, callback) {
        jq.ajax({
            method: "POST",
            url: "api/updateScore.php",
            data: {
                score: score,
                walletAddress: wallAddress
            }
        })
            .done(function (data) {
                console.log(data);
                getScore();
            });

    }


    function getScore(page) {
        jq('#scoreLeaderboard .modal-body').html(loadingSpinner);
        jq('#scoreLeaderboard').modal('show');
        jq.ajax({
            method: "POST",
            url: "api/getScore.php",
            data: {
                walletAddress: wallAddress,
                page: page
            }
        })
            .done(function (data) {
                console.log(data);
                jq('#scoreLeaderboard .modal-body').html(data);
                jq('#scoreLeaderboard .modal-body a').on('click', function (event) {
                    page = jq(event.target).data("page");
                    console.log(page)
                    getScore(page);
                });
                $(document).on('keypress',function(e) {
                    if(e.which == 13) {
                        jq('#scoreLeaderboard').modal('hide');
                    }
                });
            });
    }

    function showScore() {

    }

    jq('#login').modal('show');
    jq('.playAsGuest').on('click', function (event) {
        jq('#login').modal('hide');
        enterGame(0);
        wallAddress = 'guest';
    });
</script>

</body>
</html>